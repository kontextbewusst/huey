<!doctype html>
<html lang='en-US'>
<head>
  <meta charset='UTF-8'>
  <title>Huey</title>
  <style>
    html { height: 100% }
    body { -webkit-font-smoothing: antialiased; background: #16c no-repeat 50%; background-size: cover; color: #ece9d9; font-family: sans-serif; font-weight: bold; margin: 0 }
    #message { border-radius: 4px; display: inline-block; font-weight: bold; height: 24px; left: 50%; line-height: 24px; margin: -24px 0 0 -175px; padding: 1em; position: absolute; text-align: center; top: 45%; vertical-align: middle; width: 320px; z-index: 0}
  </style>
</head>
<body>
  <p id='message'>Drag an image from your computer into this window (nothing will be uploaded)</p>
  <script src='https://rawgithub.com/michaelrhodes/huey/master/dist/huey.min.js'></script>
  <script>
    (function(document) {
      var loading = null
      var body = document.body
      var message = document.getElementById('message')
      var caption = document.getElementById('caption')
      var input = document.createElement('input')
      input.type = 'file'

      message.ondblclick = function() {
        input.click()
      }

      document.ondragover =
      document.ondragend = function (e) {
        e.preventDefault()
      }
      input.onchange =
      document.ondrop = function (e) {
        e.preventDefault()
        var file = (
          e.dataTransfer ?
            e.dataTransfer.files[0] :
            e.target.files[0]
        )
        if (!file) {
          return
        }
        message.innerHTML = 'Calculatingâ€¦'
        var reader = new FileReader()
        reader.onload = function (e) {
          var url = e.target.result
          var start = new Date()

          huey(url, function(error, color) {
            var isGreyscale = !color
            color = color || [128,128,128]
            var total = color[0] + color[1] + color[2]
            var end = new Date()
            var time = (end.getTime() - start.getTime())

            body.style.cssText = [
              'background-color: rgb(' + color + ')',
              'background-image: url(' + url + ')'
            ].join('; ')

            message.style.cssText = [
              'background-color: rgb(' + color + ')',
              'color: ' + (total > 500 ? '#222' : '#fff')
            ].join('; ')

            message.innerHTML = (
              isGreyscale ?
                'Greyscale' :
                'rgb(' + color.join(',') + ')'
            )

            message.setAttribute('title', 'Calculated in ' + (
              time >= 1000 ?
                (time / 1000).toFixed(2) + 's' :
                time + 'ms')
            )
          })
        };
        reader.readAsDataURL(file)
      }
    })(document) 
  </script>
</body>
</html>
